# 比特币-一种点对点的电子现金系统

## 中本聪

2008年10月 中本聪在密码学网站中发表比特币白皮书。

2009年1月   中本聪开发出第一版比特币的客户端，并首次进行挖矿获得第一批50个比特币。

2010年12月 中本聪不再露面

## 摘要

目标：设计一个完全点对点技术实现的电子现金系统，实现去中心化的在线电子支付。

中本聪通过数字签名，随机散列，哈希算法，工作量证明，动态链式存储等技术，设计了一系列的机制，使比特币能够解决电子支付中的双花，记录篡改等问题。并最终证明该系统安全有效、稳定可行。

## 一、概述

### 目前网上的交易主要是基于信用模式

1. 金融中介的存在增加了交易的成本，也增加了对交易规、交易金额的限制

2. 线上支付存在可逆性，交易如果发生争端，顾客可以通过第三方机构申请退款

现金就是一种不可逆的支付方式，所以称比特币为电子现金系统。

### 比特币电子现金系统三大特性

1. 用密码学代替信用
2. 去金融中介化，提升效率，实现点对点支付
3. 杜绝可逆支付

### 双花问题

同一笔钱重复使用了两次，不被发现，或者发现时为时已晚，比特币中的各种复杂机制，其实就是为了解决双花问题。

## 二、交易

我们定义电子货币是一条数字签名链。每个拥有者都通过将上一次交易和下一个拥有者的公钥的哈希值的数字签名添加到此货币末尾的方式将这枚货币转移给下一个拥有者。收款人可以通过验证数字签名来证实其为该链的所有者。

比特币机遇UTXO（Unspent Transaction Output，未花费交易输出）的记账模型。这是一种机遇交易的记账体系，数据库记录一笔笔交易，包括首付款双方的信息，金额，上一笔交易哈希值等信息。如果要计算某个账户拥有多少电子货币，需要在账本中找到该用户的交易，来计算该用户当前的余额。

![page01](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220113202616.jpg)

非对称加密生成公钥和私钥，公钥是公开信息，用于标识用户，验证比特币的所有权；私钥只有持币者拥有，保证了比特币归属权，用于签名和授权付款。数字签名是指发起者用私钥进行签名，接受者用发起者的公钥就可以进行验证。

数字签名解决了如下问题：

1. 证明该交易是付款方发起的
2. 在传输过程中交易信息没有被篡改

但是这里还是不能解决双花的问题，是否同时给多人支付了这枚货币。

## 三、时间戳服务器

将时间戳信息纳入区块信息中，时间见证了一切。

![page02](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220113203618.jpg)

当要修改一个区块数据，就要修改其后所有已生成区块的哈希数据，还要让大多数节点形成共识。

## 四、工作量证明POW

工作量证明机制解决谁拥有记账权。

![page03](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220113204211.jpg)

通过计算一个哈希值（每个区块中加入一个随机数Nonce），并且尽可能的小，小于某个值则拥有记账权。计算复杂度随着target的变化呈指数级上升。这其实就是矿工挖矿的过程。

验证起来非常简单，只需要计算一次哈希计算即可。

每个区块中包括前一个区块的hash、随机数、以及所有交易数据。

工作量证明还证明了在多数决定中确定投票方式的问题。工作量证明本质上按照CPU算力来投票，因为他有最大的工作量证明投票到这条链上。如果多数的CPU被诚实的节点控制，那么诚实的链就会增长的最快，并超过其他竞争链。要修改过去的某个区块，攻击者必须重新做这个区块，以及其后所有区块的工作量证明。这种概率会随着后去区块的增长而大大减小，成本也会远远大于收益。

工作量证明会通过移动平均数法来确定每个小时生成区块的平均个数。保持在10分钟一个区块的水平。



## 五、网络Network

运行整个比特币网络分为6个步骤

1. 每一笔新的交易都要向所有节点广播
2. 每个节点要将新交易收集到一个区块中
3. 每个节点要为它的区块寻找工作量证明
4. 当一个节点找到了工作量证明，就要向所有节点广播这个区块
5. 节点只有在验证区块内所有交易都是有效的，且没有双重支付的情况下，接受这个区块
6. 节点使用这个区块的哈希值，作为上一个区块的哈希值，记录在新区块中，就表示接受了这个区块。

节点总是认为最长的链是正确的，并持续维护和延长它。如果两个节点同时广播了不同的新区块，不同节点可能收到不同区块，这种情况下各个节点基于先收到的区块工作，但也保存另一个分支，以防止他变成更长的链。当下一个工作量证明被找到后，僵局就会被打破，从而其中一个分支变得更长。在另一个分支上工作的节点，将切换到更长的链上。

新交易的广播，不必达到所有节点才生效，只要达到部分节点，不久就会被打包进区块中，区块广播也能容忍一定程度消息丢失，如果一个节点没有收到某个区块，那将在收到下一个区块时，发现它丢失了一个区块，然后再去请求这个区块，所以比特币系统有很强的容错性和鲁棒性。

## 六、激励政策Incentive

> 激励 = 挖矿奖励 + 交易手续费

比特币发行总量大约2100万枚，每发行21万，比特币会减半一次，当比特币挖完了，就只剩下手续费了。

## 七、回收磁盘空间

利用默克尔树的二叉树结构来压缩数据，节约交易数据的存储成本。

![page04](https://cdn.jsdelivr.net/gh/mouweng/FigureBed/img/20220113233544.jpg)

默克尔书是由一个根节点、一组中间节点和一组叶节点组成。

叶节点包含存储数据和他的哈希值，中间节点和根节点是其两个子节点的哈希值

默克尔树里的哈希值，既不占用空间，又能提升索引效率，还能用于零知识证明。每年生成4.2M的数据，即使全部存储在内存中也毫无问题。

本章的核心就是，将大量数据进行哈希运算后，增加其分布式索引的性能，并且通过维持一个较小的高效索引也就是默克尔路径，进而来管理复杂而又大量的数据。

## 八、简化的支付验证

不用运行一个完整的节点，也可以进行支付验证。

实际上用户只要有最长共识链的区块头数据就行了，可以通过向其他网络查询来确保自己有最长链的数据，然后将交易链接到对应的默克尔分支，知道有节点接受了这笔交易，以及后面的区块确认此交易，并最终被整个网络接受。

如果面临攻击，这种简化验证就会有较高的风险。

对于高频的首付款公司或者企业级的服务商，中本聪还是建议维护一个自己的全节点

## 九、合并和分割交易

一笔交易可以有多个付款方和多个收款方，且收款方还可以是付款方自己。

这样可以提升效率和节约手续费

## 十、隐私

所有的交易都是公开的，比特币是保持公钥的匿名性来保证用户的隐私，用户无需注册和使命审核，在匿名的情况下就能交易货币。

## 十一、计算

利用公式和代码来计算在实践中，比特币被攻击的概率非常非常低。

## 参考

[读懂比特币白皮书，区块链开山之作，中本聪到底说了什么？| 李查说](https://www.bilibili.com/video/BV1Hh411Z7id?from=search&seid=17531417366321393806&spm_id_from=333.337.0.0)

[比特币:一种点对点的电子现金系统](https://nakamotoinstitute.org/static/docs/bitcoin-zh-cn.pdf)

